import { serve } from '@hono/node-server';
import { ExecutionContext, Hono } from 'hono';
import { createHTTPHandler } from '@trpc/server/adapters/standalone';
import { initTRPC } from '@trpc/server';
import { adminRouter } from './routes/adminRouter';
import { groupRouter } from './routes/groupRouter';
import { postRouter } from './routes/postsRouter';
import { userRouter } from './routes/userRouter';
import { reactionRouter } from './routes/reactionRouter';
import 'reflect-metadata';

const t = initTRPC.create();

// Criando o appRouter combinando os routers
const appRouter = t.mergeRouters(
  adminRouter,
  groupRouter,
  postRouter,
  userRouter,
  reactionRouter
);

const app = new Hono({
  strict: true, // Modo estrito ativado
  getPath: (req) => '/' + req.headers.get('host') + req.url.replace(/^https?:\/\/[^/]+(\/[^?]*)/, '$1'),
});

// Definindo uma rota GET
app.get('/hello', (c) => c.text('Hello World!'));

// Tratando erros
app.onError((err, c) => {
  console.error(err);
  return c.text('Internal Server Error', 500);
});

// Definindo uma rota padrÃ£o 404
app.notFound((c) => c.text('Not Found', 404));

// Subindo o servidor no Node.js usando @hono/node-server
const PORT = process.env.PORT || 3000;

serve(app, { port: Number(PORT) });
